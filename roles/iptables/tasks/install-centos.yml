---

# check firewalld vs disabled on centos7

- name: Check if firewalld package is installed (on RHEL).
  command: yum list installed firewalld
  args:
    warn: false                                                 ## hien thi warning khi run task, false: ko hien thi
  register: firewalld_installed
  ignore_errors: true
  changed_when: false                                           ## changed_when DK, return code or its stdout or stderr command
  tags:
    - iptables-Cen7                                           

- name: Disable the firewalld service (on RHEL, if configured).
  service:
    name: firewalld
    state: stopped
    enabled: false
  when:
    - firewall_disable_firewalld                                # bien firewall_disable_firewalld: false
    - firewalld_installed.rc == 0                               # retrun code 0 command tren thuc hien thanh cong, 1 failed.
  tags:
    - iptables-Cen7

- name: Install iptables packages
  yum:
    name: "{{ item }}"
    state: present
  with_items:
    - iptables
  tags:
    - iptables-Cen7

- name: Flush iptables the first time playbook runs.
  command: >
    iptables -F
    creates=/etc/firewall.bash
  tags:
    - iptables-Cen7

- name: Copy firewall script into place.
  template:
    src: firewall.bash.j2
    dest: /etc/firewall.bash
    owner: root
    group: root
    mode: 0744
  notify: restart firewall
  tags:
    - iptables-Cen7

- name: Copy firewall init script into place.
  template:
    src: firewall.init.j2
    dest: /etc/init.d/firewall
    owner: root
    group: root
    mode: 0755
  when: "ansible_service_mgr != 'systemd'"
  tags:
    - iptables-Cen7

- name: Copy firewall systemd unit file into place (for systemd systems).
  template:
    src: firewall.unit.j2
    dest: /etc/systemd/system/firewall.service
    owner: root
    group: root
    mode: 0644
  when: "ansible_service_mgr == 'systemd'"
  tags:
    - iptables-Cen7

- name: Configure the firewall service.
  service:
    name: firewall
    state: started
    enabled: true
  tags:
    - iptables-Cen7







